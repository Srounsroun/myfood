<script type="text/javascript">
    window.onload = function onLoad(e) {

        var OptionList = $("#OptionList").data("kendoListView");
        var currentProductionUnitLat;
        var currentProductionUnitLong;

        $.ajax({
            url: "@Url.Action("GetNetworkStats", "Home")",
            dataType: "json",
        type: "POST",
        success: function (response) {
            $("#ProductionUnitNumber").text('TOTAL CONNECTED: ' + response.ProductionUnitNumber);
            $("#TotalMonthlyProduction").text('TOTAL EST. PROD. PER MONTH: ' + response.TotalMonthlyProduction + 'kg');
            $("#TotalMonthlySparedCO2").text('TOTAL CO2 NOT RELEASED PER MONTH: ' + response.TotalMonthlySparedCO2 + 'kg');
        }
        });

        $.ajax({
            url: "@Url.Action("GetRandomProductionUnitDetail", "Home")",
            dataType: "json",
            type: "POST",
            success: function (response) {
            $("#PioneerCitizenName").text('NAME: ' + response.PioneerCitizenName);
            $("#PioneerCitizenNumber").text('NUMBER: ' + response.PioneerCitizenNumber);
            $("#ProductionUnitType").text('TYPE: ' + response.ProductionUnitType);
            $("#ProductionUnitVersion").text('VERSION: ' + response.ProductionUnitVersion);
            $("#ProductionUnitStartDate").text('START DATE: ' + kendo.toString(kendo.parseDate(response.ProductionUnitStartDate, 'yyyy-MM-dd'), 'MM/dd/yyyy'));

            $("#CurrentPhValue").text(response.CurrentPhValue);
            $("#CurrentPhCaptureTime").text(response.CurrentPhCaptureTime);
            $("#AverageHourPhValue").text(response.AverageHourPhValue);
            $("#AverageDayPhValue").text(response.AverageDayPhValue);
            $("#LastDayPhCaptureTime").text(response.LastDayPhCaptureTime);

            $("#CurrentWaterTempValue").text(response.CurrentWaterTempValue);
            $("#CurrentWaterTempCaptureTime").text(response.CurrentWaterTempCaptureTime);
            $("#AverageHourWaterTempValue").text(response.AverageHourWaterTempValue);
            $("#AverageDayWaterTempValue").text(response.AverageDayWaterTempValue);
            $("#LastDayWaterTempCaptureTime").text(response.LastDayWaterTempCaptureTime);
                
            $("#CurrentAirTempValue").text(response.CurrentAirTempValue);
            $("#CurrentAirTempCaptureTime").text(response.CurrentAirTempCaptureTime);
            $("#AverageHourAirTempValue").text(response.AverageHourAirTempValue);
            $("#AverageDayAirTempValue").text(response.AverageDayAirTempValue);
            $("#LastDayAirTempCaptureTime").text(response.LastDayAirTempCaptureTime);

            $("#CurrentHumidityValue").text(response.CurrentHumidityValue);
            $("#CurrentHumidityCaptureTime").text(response.CurrentHumidityCaptureTime);
            $("#AverageHourHumidityValue").text(response.AverageHourHumidityValue);
            $("#AverageDayHumidityValue").text(response.AverageDayHumidityValue);
            $("#LastDayHumidityCaptureTime").text(response.LastDayHumidityCaptureTime);

            currentProductionUnitLat = response.LocationLatitude;
            currentProductionUnitLong = response.LocationLongitude;

            OptionList.dataSource.read({ SelectedProductionUnitLat: currentProductionUnitLat, SelectedProductionUnitLong: currentProductionUnitLong });

        }
        });

    }

    function onShow(e) {

        var OptionList = $("#OptionList").data("kendoListView");

        var currentProductionUnitLat = this.marker.options.location[0];
        var currentProductionUnitLong = this.marker.options.location[1];

        $.ajax({
                url: "@Url.Action("GetProductionUnitDetail", "Home")",
                dataType: "json",
                data: { SelectedProductionUnitLat: currentProductionUnitLat, SelectedProductionUnitLong: currentProductionUnitLong },
                type: "POST",
                success: function (response) {
                $("#PioneerCitizenName").text('NAME: ' + response.PioneerCitizenName);
                $("#PioneerCitizenNumber").text('NUMBER: ' + response.PioneerCitizenNumber);
                $("#ProductionUnitType").text('TYPE: ' + response.ProductionUnitType);
                $("#ProductionUnitVersion").text('VERSION: ' + response.ProductionUnitVersion);
                $("#ProductionUnitStartDate").text('START DATE: ' + kendo.toString(kendo.parseDate(response.ProductionUnitStartDate, 'yyyy-MM-dd'), 'MM/dd/yyyy'));

                $("#CurrentPhValue").text(response.CurrentPhValue);
                $("#CurrentPhCaptureTime").text(response.CurrentPhCaptureTime);
                $("#AverageHourPhValue").text(response.AverageHourPhValue);
                $("#AverageDayPhValue").text(response.AverageDayPhValue);
                $("#LastDayPhCaptureTime").text(response.LastDayPhCaptureTime);

                $("#CurrentWaterTempValue").text(response.CurrentWaterTempValue);
                $("#CurrentWaterTempCaptureTime").text(response.CurrentWaterTempCaptureTime);
                $("#AverageHourWaterTempValue").text(response.AverageHourWaterTempValue);
                $("#AverageDayWaterTempValue").text(response.AverageDayWaterTempValue);
                $("#LastDayWaterTempCaptureTime").text(response.LastDayWaterTempCaptureTime);
                
                $("#CurrentAirTempValue").text(response.CurrentAirTempValue);
                $("#CurrentAirTempCaptureTime").text(response.CurrentAirTempCaptureTime);
                $("#AverageHourAirTempValue").text(response.AverageHourAirTempValue);
                $("#AverageDayAirTempValue").text(response.AverageDayAirTempValue);
                $("#LastDayAirTempCaptureTime").text(response.LastDayAirTempCaptureTime);

                $("#CurrentHumidityValue").text(response.CurrentHumidityValue);
                $("#CurrentHumidityCaptureTime").text(response.CurrentHumidityCaptureTime);
                $("#AverageHourHumidityValue").text(response.AverageHourHumidityValue);
                $("#AverageDayHumidityValue").text(response.AverageDayHumidityValue);
                $("#LastDayHumidityCaptureTime").text(response.LastDayHumidityCaptureTime);
                }
            });
        
        OptionList.dataSource.read({ SelectedProductionUnitLat: currentProductionUnitLat, SelectedProductionUnitLong: currentProductionUnitLong });
    }

    function onShapeCreated(e) {
        var shape = e.shape;
        var users = shape.dataItem.properties.users;
        if (users) {
            var color = scale(users).hex();
            shape.options.fill.set("color", color);
        }
    }

    function onShapeMouseEnter(e) {
        e.shape.options.set("fill.opacity", 1);
    }

    function onShapeMouseLeave(e) {
        e.shape.options.set("fill.opacity", 0.7);
    }

</script>

<script type="text/x-kendo-tmpl" id="templateOption">
    <div class="option">
        <span>&bull; #:name#</span>
    </div>
</script>

<div id="main-section-header" class="row">
    <h2 id="title-pioneer" class="col-md-3">Pioneer Citizen Network</h2>
    <div style="clear:both;"></div>
</div>

<div id="pioneer-network" class="main-section-content row">
    <div id="map-wrapper" class="row">
        <div id="map-details" class="col-md-4">
            <div>
                <h2 id="ProductionUnitNumber"></h2>
                <h2 id="TotalMonthlyProduction"></h2>
                <h2 id="TotalMonthlySparedCO2"></h2>
            </div>
            <br/>
            <h2 id="PioneerCitizenName"></h2>
            <div id="PioneerCitizenNumber"><span></span></div>
            <div id="ProductionUnitType"><span></span></div>
            <div id="ProductionUnitVersion"><span></span></div>
            <div id="ProductionUnitStartDate"><span></span></div>
            <h3 class="section-header">OPTIONS</h3>           
            @(Html.Kendo().ListView<myfoodapp.Hub.Models.Option>()
            .Name("OptionList")
            .TagName("div")
            .ClientTemplateId("templateOption")
            .DataSource(dataSource => dataSource
              .Read(read => read.Action("Option_Read", "Home"))
            )
            )
        </div>
        <div id="map-container" class="col-md-8">
        @model myfoodapp.Hub.Models.Map

         @(Html.Kendo().Map()
        .Name(Model.Name)
        .Center(Model.CenterLatitude, Model.CenterLongitude)
        .Zoom(Model.Zoom)
        .Zoomable(false)
        .Layers(layers =>
                {
                    layers.Add()
                        .Style(style => style
                            .Fill(fill => fill.Color("#018001").Opacity(0.7))
                            .Stroke(stroke => stroke.Color("#FFFFFF"))
                        )
                        .Type(MapLayerType.Shape)
                        .DataSource(dataSource => dataSource
                            .GeoJson()
                            .Read(read => read.Url(Url.Content("~/Content/countries.geo.txt")))
                        );
                })
        .Markers(markers =>
        {
            foreach (var marker in Model.Markers)
            {
                markers.Add()
                .Location(marker.latlng)
                .Shape(marker.shape)
                .Tooltip(t => t.ShowOn(TooltipShowOnEvent.MouseEnter))
                .Tooltip(t => t.Events(e => e.Show("onShow")))
                .Title(marker.name);               
            }
        })
        .Events(events => events
                          .ShapeCreated("onShapeCreated")
                          .ShapeMouseEnter("onShapeMouseEnter")
                          .ShapeMouseLeave("onShapeMouseLeave")
            )
        )
        </div>
</div>

<div id="statsContainer" class="row">
        <div id="pHContainer" class="col-md-3">
            <h3 class="section-header" style="text-align:center;font-size:larger">pH</h3>
            <div class="sparkline-container">
                <div style="margin: 3px;">
                    <div class="column-left">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-tachometer" aria-hidden="true"></i>&nbsp; CURRENT</h2>
                        <h1 id="CurrentPhValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="CurrentPhCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                    <div class="column-center" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageHourPhValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 style="margin:7px;text-align: center;">PAST HOUR</h2>
                    </div>
                    <div class="column-right" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageDayPhValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="LastDayPhCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                </div>    
            </div>
        </div>
        <div id = "WaterTempContainer" class="col-md-3">
            <h3 class="section-header" style="text-align:center;font-size:larger">Water Temperature (°C)</h3>
            <div class="sparkline-container">
                <div style="margin: 3px;">
                    <div class="column-left">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-tachometer" aria-hidden="true"></i>&nbsp; CURRENT</h2>
                        <h1 id="CurrentWaterTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="CurrentWaterTempCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                    <div class="column-center" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageHourWaterTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 style="margin:7px;text-align: center;">PAST HOUR</h2>
                    </div>
                    <div class="column-right" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageDayWaterTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="LastDayWaterTempCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                </div>  
            </div>
        </div>
        <div id="AirTempContainer" class="col-md-3">
            <h3 class="section-header" style="text-align:center;font-size:larger">Air Temperature (°C)</h3>
            <div class="sparkline-container">
                <div style="margin: 3px;">
                    <div class="column-left">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-tachometer" aria-hidden="true"></i>&nbsp; CURRENT</h2>
                        <h1 id="CurrentAirTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="CurrentAirTempCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                    <div class="column-center" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageHourAirTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 style="margin:7px;text-align: center;">PAST HOUR</h2>
                    </div>
                    <div class="column-right" style="border-left:1px solid #e2e2e2;">
                        <h2 style="margin:7px;text-align: center;"><i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                        <h1 id="AverageDayAirTempValue" style="font-size:xx-large;text-align: center;">-</h1>
                        <h2 id="LastDayAirTempCaptureTime" style="margin:7px;text-align: center;">-</h2>
                    </div>
                </div>
            </div>
        </div>
    <div id="HumidityContainer" class="col-md-3">
        <h3 class="section-header" style="text-align:center;font-size:larger">Humidity (%)</h3>
        <div class="sparkline-container">
            <div style="margin: 3px;">
                <div class="column-left">
                    <h2 style="margin:7px;text-align: center;"><i class="fa fa-tachometer" aria-hidden="true"></i>&nbsp; CURRENT</h2>
                    <h1 id="CurrentHumidityValue" style="font-size:xx-large;text-align: center;">-</h1>
                    <h2 id="CurrentHumidityCaptureTime" style="margin:7px;text-align: center;">-</h2>
                </div>
                <div class="column-center" style="border-left:1px solid #e2e2e2;">
                    <h2 style="margin:7px;text-align: center;"><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                    <h1 id="AverageHourHumidityValue" style="font-size:xx-large;text-align: center;">-</h1>
                    <h2 style="margin:7px;text-align: center;">PAST HOUR</h2>
                </div>
                <div class="column-right" style="border-left:1px solid #e2e2e2;">
                    <h2 style="margin:7px;text-align: center;"><i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp; AVERAGE</h2>
                    <h1 id="AverageDayHumidityValue" style="font-size:xx-large;text-align: center;">-</h1>
                    <h2 id="LastDayHumidityCaptureTime" style="margin:7px;text-align: center;">-</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="performanceHealthAnalysis">
    <div id="performanceHealthAnalysisContainer" class="col-md-4">
        <h3 class="section-header">Performance and Health Analysis</h3> 
        @*@(Html.Kendo().Chart()
            .Name("PerfChart")
            .Legend(legend => legend
                .Visible(false)
                .Position(ChartLegendPosition.Top)
            )
            .ChartArea(ch => ch.Background("#eeeeee"))
            .Series(series =>
            {
                series.Column(new double[] { 23, 39, 27 }).Color("#018001");
            })
            .HtmlAttributes(new { @style = "height: 150px;" })
            .CategoryAxis(axis => axis
                .Categories("Jul", "Agu", "Sep")
                .MajorGridLines(m => m.Visible(true))
                .Line(l => l.Width(0))
                .Labels(l => l.Visible(false))
            )
            .ValueAxis(axis => axis
                .Numeric()
                .Line(line => line.Visible(false))
                .MajorTicks(x => x.Visible(false))
                .MajorGridLines(m => m.Visible(true))
                .Line(l => l.Visible(false))
                .Labels(l => l.Visible(false))
             )
            .Tooltip(tooltip => tooltip
            .Visible(true)
            .Format("{0}%")
            .Template("#= category #: #= value # kg")
        )
        )*@
    </div>
</div>

</div>

<style>

    .column-left {
        float: left;
        width: 33%;
    }

    .column-right {
        float: right;
        width: 33%;
    }

    .column-center {
        display: inline-block;
        width: 33%;
    }

    #OptionList {
        background: transparent;
        border-color: transparent;
        color: #333      
    }

    .k-listview:after {
        content: ".";
        display: block;
        height: 0;
        clear: both;
        visibility: hidden;
    }

    .k-map .k-marker-red-marker {
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AoMDSM0TTMGvAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAHUlEQVQ4y2M8Iy7OQC5gYqAAjGoe1TyqeVQz5ZoBCogBIhwXVIUAAAAASUVORK5CYII=');
        width: 10px;
        height: 10px;
        margin: -5px 0 0 -5px;
    }

    .k-tooltip-content {
        background-color:#018001;
        stroke:black;  
    }

    .k-widget.k-tooltip {
        background-color:#018001;
        stroke:black;  
    }

    .k-loading-mask {
        opacity: 0;
    }

</style>




